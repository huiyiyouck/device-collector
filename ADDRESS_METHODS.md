# 地址获取方法说明

## 当前实现的方法

### 1. 高德地图（Amap）- 主要方法 ✅
- **API**: 高德地图逆地理编码 API
- **坐标系**: GCJ02（火星坐标系）
- **状态**: 正常使用
- **特点**: 
  - 精度高，适合中国境内
  - 支持详细地址信息（省、市、区、街道、POI等）
  - 免费额度充足

### 2. 百度地图（Baidu）- 备用方法 ⚠️
- **API**: 百度地图逆地理编码 API
- **坐标系**: BD09（百度坐标系）
- **状态**: 需要配置（可能被禁用）
- **特点**:
  - 需要配置 IP 白名单
  - 可能需要"服务端AK"（不能用于浏览器端）
  - 如果服务被禁用，会自动降级为仅使用高德

## 其他可用的地址获取方法

### 3. 腾讯地图（Tencent Map）
- **API**: 腾讯位置服务逆地址解析
- **坐标系**: GCJ02
- **优点**: 
  - 免费额度较高
  - 精度较好
  - 支持国内地址
- **缺点**: 需要申请 API Key

### 4. OpenStreetMap Nominatim（免费）
- **API**: Nominatim API
- **坐标系**: WGS84
- **优点**: 
  - 完全免费
  - 无需 API Key
  - 全球覆盖
- **缺点**: 
  - 国内地址精度较低
  - 有请求频率限制（1秒1次）
  - 需要遵守使用条款

### 5. Google Maps Geocoding API
- **API**: Google Geocoding API
- **坐标系**: WGS84
- **优点**: 
  - 全球精度最高
  - 支持多语言
- **缺点**: 
  - 需要付费（有免费额度）
  - 需要 API Key
  - 国内访问可能受限

### 6. 天地图（国家基础地理信息公共服务平台）
- **API**: 天地图逆地理编码
- **坐标系**: GCJ02
- **优点**: 
  - 官方权威数据
  - 免费使用
- **缺点**: 
  - 需要申请 API Key
  - 文档相对较少

## 当前代码中的实现

### 后端地址获取
- **主要方法**: 高德地图（`getAmapAddressFromCoords`）
- **备用方法**: 百度地图（`getBaiduAddressFromCoords`）
- **调用位置**: `/api/device-data` 端点

### 前端地址获取
- **当前**: 通过 `/api/address` 端点获取高德地址
- **可选**: 通过 `includeBaidu=true` 参数同时获取百度地址

## 如何添加新的地址获取方法

1. 在 `server.js` 中添加新的获取函数，例如：
```javascript
async function getTencentAddressFromCoords(lat, lon) {
  // 实现腾讯地图地址获取
}
```

2. 在 `/api/device-data` 端点中调用新方法
3. 更新数据库表结构（如果需要新字段）
4. 更新 `saveToDatabase` 函数

## 百度地址获取问题排查

如果百度地址获取失败，可能的原因：
1. **IP 白名单未配置**: 需要在百度地图开放平台配置服务器 IP
2. **服务被禁用**: 访问 http://lbsyun.baidu.com/apiconsole/key# 查看应用状态
3. **API Key 类型错误**: 确保使用"服务端AK"（不是浏览器端AK）
4. **配额用完**: 检查 API 调用次数是否超限

## 建议

- **主要使用**: 高德地图（稳定、准确）
- **备用方案**: 百度地图（如果配置成功）
- **未来扩展**: 可以考虑添加腾讯地图作为第三个备用方案

