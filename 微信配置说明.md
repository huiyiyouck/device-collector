# 微信 JS-SDK 配置说明

## 重要提示

要在微信中自动获取用户位置，需要在微信公众平台配置 **JS 接口安全域名**。

## 配置步骤

### 1. 登录微信公众平台
访问：https://mp.weixin.qq.com

### 2. 配置 JS 接口安全域名
1. 进入 **设置** → **公众号设置**
2. 点击 **功能设置** 标签
3. 找到 **JS 接口安全域名**
4. 点击 **设置**，添加以下域名：
   ```
   192.168.31.213:3000
   ```
   **注意**：微信要求使用已备案的域名，局域网 IP 可能无法通过验证。

### 3. 如果使用公网域名（推荐）
如果您的服务器有公网 IP 或域名，建议：
1. 使用公网域名（如：`yourdomain.com`）
2. 在微信公众平台配置该域名
3. 更新 `.env` 文件中的 `WX_REDIRECT_URI`

### 4. 测试配置
配置完成后，在微信中访问：
```
http://192.168.31.213:3000
```

## 当前配置

- **AppID**: wxbef604f4e423653d
- **AppSecret**: 已配置（在 .env 文件中）
- **重定向 URI**: http://192.168.31.213:3000/
- **服务器地址**: http://192.168.31.213:3000

## 功能说明

配置完成后，用户在微信中打开链接：
1. 页面会自动加载微信 JS-SDK
2. 自动获取用户位置（需要用户授权）
3. 自动获取地址信息
4. 自动保存到数据库

## 注意事项

1. **位置权限**：首次使用时，微信会弹出位置权限请求，用户需要点击"允许"
2. **JS 安全域名**：必须配置，否则 JS-SDK 无法使用
3. **网络环境**：确保手机和服务器在同一局域网，或使用公网访问
4. **HTTPS**：如果使用公网域名，建议使用 HTTPS（微信对 HTTPS 支持更好）

## 故障排查

### 问题1：JS-SDK 配置失败
- 检查 JS 接口安全域名是否已配置
- 检查 AppID 和 AppSecret 是否正确
- 查看浏览器控制台错误信息

### 问题2：无法获取位置
- 检查手机 GPS 是否开启
- 检查微信位置权限是否开启
- 尝试在户外开阔地带测试

### 问题3：签名错误
- 检查服务器时间是否正确
- 检查 URL 是否包含 # 后面的部分（签名时已自动去除）

